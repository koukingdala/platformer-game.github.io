<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="description" content="2人対戦のプラットフォームゲームです。GitHub Pagesで公開中。"/>
  <link rel="icon" type="image/png" href="favicon.png">
  <title>対戦型プラットフォーマー</title>
  <style>
    *{box-sizing:border-box}body{margin:0;overflow:hidden;height:100vh;background:linear-gradient(#9ed6ff,#bfe9ff)}
    .sun{position:absolute;right:6vh;top:4vh;width:140px;height:140px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff59d,#ffd27a 40%,#ffc34d 60%,#ffb347 100%);filter:blur(4px)}
    .g{position:absolute;left:0;right:0;bottom:0;height:20vh;background:linear-gradient(to top,#84331F 70%,#3ea34a 30%);box-shadow:0 -6px 20px rgba(0,0,0,.15) inset}
    .c{position:absolute;width:40px;height:40px;will-change:transform;pointer-events:none}
    .i{width:100%;height:100%;display:flex;align-items:center;justify-content:center;transition:transform .08s linear}
    .b{width:100%;height:100%;background:#000;border-radius:10px;transform-origin:center bottom;transition:transform .12s ease,border-radius .12s;box-shadow:0 6px 12px rgba(0,0,0,.25)}
    .c.walking .b{animation:walk .36s linear infinite;border-radius:9px}@keyframes walk{0%{transform:translateY(0) scaleY(1)}50%{transform:translateY(-6px) scaleY(.95)}100%{transform:translateY(0) scaleY(1)}}
    .c.jumping .b{animation:none;transform:translateY(0) scaleY(1.12);border-radius:8px}
    .c.land .b{animation:land .18s ease forwards}@keyframes land{0%{transform:translateY(0) scaleY(1.08)}50%{transform:translateY(0) scaleY(.82)}100%{transform:translateY(0) scaleY(1)}}
    .i.left{transform:scaleX(-1)}
    .s{position:absolute;left:50%;bottom:-6px;width:24px;height:6px;margin-left:-12px;background:rgba(0,0,0,.25);border-radius:50%;filter:blur(4px);transition:transform .12s,opacity .12s}
    .c.jumping .s{transform:scale(.6);opacity:.6}
    .c.land .s{transform:scale(1.05);opacity:.9}
    .label{position:fixed;transform:translateX(-50%);font-size:12px;font-weight:700;pointer-events:none;z-index:10}
    .hp{position:fixed;top:10px;left:10px;width:160px;height:18px;background:rgba(0,0,0,.15);border-radius:10px;overflow:hidden}
    .hp .in{height:100%;background:rgba(255,100,100,.9);width:100%}
    .hp.r{left:auto;right:10px}
    .hp.r .in{background:rgba(100,140,255,.95)}
    .bullet{position:absolute;width:14px;height:14px;border-radius:50%;background:#ff4b4b;display:flex;align-items:center;justify-content:center;font-size:10px;color:#fff}
    .btxt{position:absolute;top:-14px;font-size:10px;font-weight:700;pointer-events:none}
    .ov{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;z-index:999;display:none}
  </style>
</head>
<body>
  <div class="sun"></div>
  <div class="g" id="g"></div>
  <div class="c" id="p1"><div class="i" id="i1"><div class="b"></div></div><div class="s"></div></div>
  <div class="c" id="p2"><div class="i" id="i2"><div class="b"></div></div><div class="s"></div></div>
  <div class="label" id="l1" style="color:rgba(160,90,90,.9)">1P</div>
  <div class="label" id="l2" style="color:rgba(90,120,160,.95)">2P</div>
  <div class="hp" id="h1"><div class="in" id="hi1"></div></div>
  <div class="hp r" id="h2"><div class="in" id="hi2"></div></div>
  <div class="ov" id="ov"></div>
  <script>
    const g=document.getElementById('g'),p1=document.getElementById('p1'),p2=document.getElementById('p2'),i1=document.getElementById('i1'),i2=document.getElementById('i2'),l1=document.getElementById('l1'),l2=document.getElementById('l2'),hi1=document.getElementById('hi1'),hi2=document.getElementById('hi2'),ov=document.getElementById('ov');
    const W=40,H=40,S=6,G=1,J=-18,BS=9;let sw=innerWidth,sh=innerHeight,k={};
    addEventListener('resize',()=>{sw=innerWidth;sh=innerHeight});
    addEventListener('keydown',e=>k[e.key]=1);
    addEventListener('keyup',e=>k[e.key]=0);
    let R=Math.max(1,parseInt(prompt('何本勝負にしますか？','3'))||3);
    let p=[{x:20,y:0,vx:0,vy:0,last:1,on:1,hp:100,guard:0,alive:1,w:0,el:p1,ie:i1,l:l1},{x:sw-W-20,y:0,vx:0,vy:0,last:-1,on:1,hp:100,guard:0,alive:1,w:0,el:p2,ie:i2,l:l2}];
    function gy(){return g.getBoundingClientRect().top}
    p[0].y=p[1].y=gy()-H;
    let B=[];
    function mk(x,y,v,o){let e=document.createElement('div'),t=document.createElement('div');e.className='bullet';t.className='btxt';t.textContent=o==0?'1P':'2P';e.appendChild(t);document.body.appendChild(e);B.push({e,x,y,v,o,t})}
    function resp(i){p[i].alive=0;setTimeout(()=>{p[i].x=Math.random()*(sw-W);p[i].y=gy()-H;p[i].hp=100;p[i].alive=1},800)}
    function hit(b,pl){if(!pl.alive||pl.guard||pl===p[b.o])return false;let bx=b.x,by=b.y,px=pl.x,py=pl.y;if(bx+14>px&&bx<px+W&&by+14>py&&by<py+H){pl.hp-=20;pl.x+= (b.v>0?6:-6);pl.vy=-8;return true}return false}
    function upd(){
      let ground=gy()-H;
      for(let i=0;i<2;i++){
        let u=p[i];
        let left=i==0?(k['a']||0):(k['ArrowLeft']||0),
            right=i==0?(k['d']||0):(k['ArrowRight']||0);
        if(right&&!left){u.x+=S;u.last=1}
        else if(left&&!right){u.x-=S;u.last=-1}
        if((i==0?(k['w']||0):(k['ArrowUp']||0))&&Math.abs(u.y-ground)<.5)u.vy=J;
        u.vy+=G;u.y+=u.vy;
        if(u.y>ground){u.y=ground;u.vy=0;u.on=1}else u.on=0;
        if(u.x<0)u.x=0;if(u.x+W>sw)u.x=sw-W;
        u.el.style.transform='translate('+u.x+'px,'+u.y+'px)';
        u.ie.classList.toggle('left',u.last<0);
        u.el.classList.toggle('walking',(left||right)&&u.on);
        u.el.classList.toggle('jumping',!u.on);
        if(!u.on){u.el.classList.add('land');clearTimeout(u._t);u._t=setTimeout(()=>u.el.classList.remove('land'),200)}
        u.l.style.left=(u.x+W/2)+'px';u.l.style.bottom=(sh-u.y+6)+'px'
      }
      if((k['f']||0)&&p[0].alive){
        if(!p[0]._s){p[0]._s=1;mk(p[0].x+W/2-7,p[0].y+H/2-7,BS*p[0].last,0)}
      }else p[0]._s=0;
      if((k[',']||0)&&p[1].alive){
        if(!p[1]._s){p[1]._s=1;mk(p[1].x+W/2-7,p[1].y+H/2-7,BS*p[1].last,1)}
      }else p[1]._s=0;
      p[0].guard=!!k['g'];p[1].guard=!!k['.'];
      for(let i=B.length-1;i>=0;i--){
        let bb=B[i];bb.x+=bb.v;bb.e.style.transform='translate('+bb.x+'px,'+bb.y+'px)';
        if(bb.x<-30||bb.x>sw+30){bb.e.remove();B.splice(i,1);continue}
        let targ=p[1-bb.o];
        if(hit(bb,targ)){
          bb.e.remove();B.splice(i,1);
          if(targ.hp<=0){
            p[bb.o].w++;
            if(p[bb.o].w>=R){
              ov.style.display='flex';ov.textContent=(bb.o==0?'1P':'2P')+'の勝ち';return
            }
            resp(1-bb.o)
          }
        }else bb.t.style.left='50%'
      }
      hi1.style.width=p[0].hp+'%';hi2.style.width=p[1].hp+'%';
      requestAnimationFrame(upd)
    }
    upd()
  </script>
</body>
</html>
